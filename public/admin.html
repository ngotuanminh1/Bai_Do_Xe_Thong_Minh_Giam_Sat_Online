<!DOCTYPE html>
<html lang="vi">

<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Admin - Qu·∫£n l√Ω B√£i ƒê·ªó Xe</title>
  <script src="https://unpkg.com/html5-qrcode@2.3.8/html5-qrcode.min.js"></script>
  <link rel="stylesheet" href="admin-style.css" />

  <style>
    /* --- Container cƒÉn gi·ªØa --- */
    .container {
      max-width: 960px;
      margin: 0 auto;
      padding: 0 20px;
      font-family: Arial, sans-serif;
    }

    /* --- B·∫£ng full-width --- */
    .full-width-table {
      width: 100%;
      max-width: none;
      border-collapse: collapse;
      margin-bottom: 20px;
      background: white;
      border-radius: 12px;
      overflow: hidden;
      box-shadow: 0 6px 15px rgba(0, 0, 0, 0.1);
    }

    .full-width-table th,
    .full-width-table td {
      padding: 10px 15px;
      border: 1px solid #ddd;
      text-align: left;
    }

    .full-width-table thead {
      background-color: #0a74da;
      color: white;
    }

    /* --- N√∫t X√≥a --- */
    button.delete {
      background-color: #dc3545;
      border: none;
      color: white;
      padding: 5px 10px;
      border-radius: 5px;
      cursor: pointer;
      transition: background-color 0.3s ease;
    }

    button.delete:hover {
      background-color: #c82333;
    }

    /* --- KPI cards --- */
    .card {
      background: white;
      border-radius: 12px;
      padding: 15px 20px;
      box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
      margin-bottom: 20px;
    }

    .kpi {
      display: inline-block;
      width: calc(25% - 10px);
      margin-right: 10px;
      text-align: center;
      vertical-align: top;
    }

    .kpi h3 {
      margin-bottom: 10px;
      font-weight: 600;
    }

    .kpi p {
      font-size: 1.8em;
      font-weight: bold;
      margin: 0;
      color: #0a74da;
    }

    .kpi:last-child {
      margin-right: 0;
    }

    /* --- Grid container for KPI --- */
    .grid {
      display: flex;
      justify-content: space-between;
      flex-wrap: wrap;
    }

    /* --- Parking map --- */
    .parking-map {
      margin-top: 10px;
      display: flex;
      flex-wrap: wrap;
      gap: 10px;
      justify-content: center;
    }

    .slot {
      width: 60px;
      height: 60px;
      border-radius: 10px;
      line-height: 60px;
      font-weight: bold;
      font-size: 1.2em;
      color: white;
      user-select: none;
      box-shadow: 0 2px 5px rgba(0, 0, 0, 0.2);
      transition: background-color 0.3s ease;
      text-align: center;
      cursor: default;
    }

    .slot.free {
      background-color: #28a745;
      /* xanh l√° */
    }

    .slot.reserved {
      background-color: #ffc107;
      /* v√†ng */
      color: #333;
    }

    /* --- N√∫t X√°c nh·∫≠n thanh to√°n --- */
    button.confirm-payment {
      background-color: #0a74da;
      border: none;
      color: white;
      padding: 6px 12px;
      border-radius: 5px;
      cursor: pointer;
      transition: background-color 0.3s ease;
    }

    button.confirm-payment:hover {
      background-color: #0056b3;
    }

    /* --- N√∫t ƒê√£ thanh to√°n (disabled) --- */
    button.confirm-payment:disabled {
      background-color: #6c757d;
      cursor: not-allowed;
    }


    .slot.occupied {
      background-color: #dc3545;
      /* ƒë·ªè */
    }

    /* --- Road visual --- */
    .bottom-row {
      display: flex;
      justify-content: center;
      gap: 10px;
    }

    .road-left,
    .road-right {
      width: 80px;
      height: 20px;
      background: #6c757d;
      border-radius: 5px;
    }

    /* --- Alert card --- */
    .alert {
      background-color: #f8d7da;
      border: 1px solid #f5c2c7;
      color: #842029;
      padding: 15px 20px;
      border-radius: 12px;
    }

    /* --- Loading spinner --- */
    .loading-spinner {
      border: 4px solid #f3f3f3;
      border-top: 4px solid #0a74da;
      border-radius: 50%;
      width: 24px;
      height: 24px;
      animation: spin 1s linear infinite;
      display: inline-block;
      vertical-align: middle;
      margin-left: 10px;
    }

    @keyframes spin {
      0% {
        transform: rotate(0deg);
      }

      100% {
        transform: rotate(360deg);
      }
    }

    /* --- Responsive --- */
    @media (max-width: 768px) {
      .kpi {
        width: 48%;
        margin-bottom: 15px;
      }

      .grid {
        flex-wrap: wrap;
      }

      .parking-map {
        gap: 8px;
      }
    }
  </style>
</head>

<body>
  <div class="container" role="main">
    <header>
      <h1>üìä Admin Dashboard ‚Äì B√£i ƒê·ªó Xe</h1>
      <h2>
        <button class="refresh" onclick="refreshAll()" aria-label="L√†m m·ªõi trang" style="margin-left: 10px;">
          üîÑ L√†m m·ªõi trang
          <span id="refreshSpinner" style="display:none;" class="loading-spinner" aria-hidden="true"></span>
        </button>
      </h2>
    </header>

    <div class="grid" role="region" aria-label="Th√¥ng tin t·ªïng quan b√£i ƒë·ªó xe">
      <div class="card kpi" aria-live="polite">
        <h3>T·ªïng ch·ªó</h3>
        <p id="tongCho">-</p>
      </div>
      <div class="card kpi" aria-live="polite">
        <h3>ƒê√£ ƒë·ªó</h3>
        <p id="daDo">-</p>
      </div>
      <div class="card kpi" aria-live="polite">
        <h3>C√≤n tr·ªëng</h3>
        <p id="conTrong">-</p>
      </div>
      <div class="card kpi" aria-live="polite">
        <h3>Xe v√†o</h3>
        <p id="xeVao">-</p>
      </div>
    </div>

    <div class="card alert" aria-live="assertive" aria-atomic="true" id="gas-alert-card" role="alert">
      <h3>C·∫£nh b√°o kh√≠ gas</h3>
      <p id="card-gas-alert">Kh√¥ng</p>
      <button id="dismiss-gas-alert-btn" style="display:none; margin-top:10px;" onclick="dismissGasAlert()">üö´ T·∫Øt c·∫£nh
        b√°o</button>
    </div>


    <div class="card" aria-label="Tr·∫°ng th√°i b√£i ƒë·ªó xe">
      <h3>üö¶ Tr·∫°ng th√°i b√£i ƒë·ªó</h3>
      <div class="parking-map" role="list" id="parking-map-container" aria-live="polite"
        aria-relevant="additions removals">
        <!-- C√°c slot s·∫Ω ƒë∆∞·ª£c render t·ª± ƒë·ªông -->
      </div>
    </div>
  </div>

  <section style="padding: 0 20px;">
    <h2>üìã Danh s√°ch ƒë·∫∑t ch·ªó</h2>
    <label for="filterProvider">L·ªçc theo v·ªã tr√≠ ƒë·∫∑t ch·ªó:
      <select id="filterProvider" aria-label="L·ªçc danh s√°ch ƒë·∫∑t ch·ªó theo v·ªã tr√≠">
        <option value="">T·∫•t c·∫£</option>
      </select>
    </label>

    <table id="reservationsTable" class="full-width-table" aria-label="Danh s√°ch ƒë·∫∑t ch·ªó" cellpadding="5"
      cellspacing="0">
      <thead>
        <tr>
          <th>T√™n</th>
          <th>Bi·ªÉn s·ªë</th>
          <th>V·ªã tr√≠ ƒë·∫∑t ch·ªó</th>
          <th>Check-in</th>
          <th>Th·ªùi gian</th>
          <th>H√†nh ƒë·ªông</th>
        </tr>
      </thead>
      <tbody>
        <tr>
          <td colspan="6" style="text-align:center;">ƒêang t·∫£i d·ªØ li·ªáu...</td>
        </tr>
      </tbody>
    </table>
  </section>

  <div style="padding: 0 20px; margin-bottom: 30px;">
    <!-- N√∫t qu√©t QR -->
    <button onclick="toggleScanner()" aria-label="M·ªü m√°y qu√©t QR ƒë·ªÉ check-in" id="toggle-scanner-btn">üì∑ Qu√©t QR
      Check-in</button>
    <button id="stop-scanner-btn" style="display:none; margin-left: 10px;" onclick="stopScanner()"
      aria-label="T·∫Øt camera qu√©t QR">‚úñÔ∏è T·∫Øt Camera</button>
    <div id="qr-reader" style="width: 300px; margin-top: 10px; display: none;"></div>

    <div id="scannerResult" aria-live="polite" style="margin-top: 10px; font-weight: bold;"></div>
  </div>

  <section style="padding: 0 20px;">
    <h2>üìà Log c·∫£m bi·∫øn (Gas)</h2>
    <table id="logsTable" class="full-width-table" aria-label="Log c·∫£m bi·∫øn kh√≠ gas" cellpadding="5" cellspacing="0">
      <thead>
        <tr>
          <th>Th·ªùi gian</th>
          <th>Gas (ppm)</th>
        </tr>
      </thead>
      <tbody>
        <tr>
          <td colspan="2" style="text-align:center;">ƒêang t·∫£i d·ªØ li·ªáu...</td>
        </tr>
      </tbody>
    </table>
  </section>

  <script>
    let html5QrcodeScanner = null;

    // Hi·ªÉn th·ªã spinner loading cho refresh to√†n trang
    function setLoading(isLoading) {
      const spinner = document.getElementById('refreshSpinner');
      spinner.style.display = isLoading ? 'inline-block' : 'none';
    }

    // T·∫°o slot b√£i ƒë·ªó xe
    function createSlotElement(index, state) {
      const slot = document.createElement('div');
      slot.classList.add('slot');
      if (state === 0) slot.classList.add('free');
      else if (state === 1) slot.classList.add('reserved');
      else if (state === 2) slot.classList.add('occupied');
      slot.id = `slot${index}`;
      slot.textContent = index + 1;
      let label = `V·ªã tr√≠ ${index + 1}, `;
      if (state === 0) label += "tr·ªëng";
      else if (state === 1) label += "ƒë√£ ƒë·∫∑t ch·ªó";
      else if (state === 2) label += "ƒëang c√≥ xe ƒë·ªó";
      slot.setAttribute('aria-label', label);
      return slot;
    }

    // Load tr·∫°ng th√°i b√£i ƒë·ªó xe t·ª´ API /status
    async function loadStatus() {
      try {
        const res = await fetch("/status", { cache: "no-store" });
        if (!res.ok) throw new Error(`HTTP ${res.status} - Kh√¥ng th·ªÉ l·∫•y tr·∫°ng th√°i`);
        const data = await res.json();

        document.getElementById("tongCho").innerText = data.tongCho ?? 0;

        if (Array.isArray(data.slots)) {
          const occupiedCount = data.slots.filter(s => s === 2).length;
          const freeCount = data.slots.filter(s => s === 0).length;
          document.getElementById("daDo").innerText = occupiedCount;
          document.getElementById("conTrong").innerText = freeCount;
        } else if (typeof data.slots === 'object' && data.slots !== null) {
          // N·∫øu slots l√† object, ƒë·∫øm s·ªë l∆∞·ª£ng theo tr·∫°ng th√°i
          let occupiedCount = 0, freeCount = 0;
          for (const key in data.slots) {
            if (data.slots[key] === 2) occupiedCount++;
            else if (data.slots[key] === 0) freeCount++;
          }
          document.getElementById("daDo").innerText = occupiedCount;
          document.getElementById("conTrong").innerText = freeCount;
        } else {
          document.getElementById("daDo").innerText = '-';
          document.getElementById("conTrong").innerText = '-';
        }

        document.getElementById("xeVao").innerText = data.xeVao ?? '-';

        // Render map b√£i ƒë·ªó
        const container = document.getElementById("parking-map-container");
        container.innerHTML = '';
        if (data.slots && (Array.isArray(data.slots) || typeof data.slots === 'object')) {
          const slotsArr = Array.isArray(data.slots) ? data.slots : Object.values(data.slots);
          slotsArr.forEach((state, idx) => {
            container.appendChild(createSlotElement(idx, state));
          });
        }

        // C·∫£nh b√°o kh√≠ gas
        const alertGas = data.gasAlert || false;
        document.getElementById("card-gas-alert").innerText = alertGas ? "C·∫£nh b√°o kh√≠ gas! üö®" : "Kh√¥ng";
        const alertCard = document.getElementById("gas-alert-card");
        const dismissBtn = document.getElementById("dismiss-gas-alert-btn");
        dismissBtn.style.display = alertGas ? 'inline-block' : 'none';
        if (alertGas) {
          alertCard.style.backgroundColor = "#f8d7da";
          alertCard.style.borderColor = "#f5c2c7";
          alertCard.style.color = "#842029";
        } else {
          alertCard.style.backgroundColor = "white";
          alertCard.style.borderColor = "#ddd";
          alertCard.style.color = "black";
        }

      } catch (error) {
        console.error("L·ªói loadStatus:", error);
        alert("Kh√¥ng th·ªÉ t·∫£i tr·∫°ng th√°i b√£i ƒë·ªó xe.");
      }
    }
    async function dismissGasAlert() {
      try {
        const response = await fetch('/dismiss-gas-alert', {
          method: 'POST',
          headers: {
            'Content-Type': 'application/json'
          },
          body: JSON.stringify({ gasAlert: false })
        });

        if (!response.ok) {
          throw new Error(`HTTP ${response.status}`);
        }

        const result = await response.json();

        if (result.success) {
          alert('ƒê√£ t·∫Øt c·∫£nh b√°o kh√≠ gas.');
          loadStatus(); // C·∫≠p nh·∫≠t l·∫°i giao di·ªán
        } else {
          alert('T·∫Øt c·∫£nh b√°o th·∫•t b·∫°i.');
        }
      } catch (err) {
        console.error('L·ªói khi t·∫Øt c·∫£nh b√°o:', err);
        alert('Kh√¥ng th·ªÉ t·∫Øt c·∫£nh b√°o.');
      }
    }

    // Load danh s√°ch ƒë·∫∑t ch·ªó t·ª´ /bookings
    async function loadReservations() {
      try {
        const res = await fetch("/bookings", { cache: "no-store" });
        if (!res.ok) throw new Error(`HTTP ${res.status} - Kh√¥ng th·ªÉ l·∫•y danh s√°ch ƒë·∫∑t ch·ªó`);
        const data = await res.json();

        const tbody = document.querySelector("#reservationsTable tbody");
        tbody.innerHTML = '';

        if (!Array.isArray(data) || data.length === 0) {
          tbody.innerHTML = '<tr><td colspan="6" style="text-align:center;">Ch∆∞a c√≥ ƒë·∫∑t ch·ªó</td></tr>';
          return;
        }

        // L·∫•y t·∫•t c·∫£ provider ƒë·ªÉ fill v√†o filter
        const providersSet = new Set(data.map(r => r.provider));
        fillFilterProvider(Array.from(providersSet));

        const filterValue = document.getElementById('filterProvider').value;

        const filtered = filterValue ? data.filter(r => r.provider === filterValue) : data;

        filtered.forEach(r => {
          const tr = document.createElement('tr');

          const tdName = document.createElement('td');
          tdName.textContent = r.name || '';

          const tdPlate = document.createElement('td');
          tdPlate.textContent = r.license || '';

          const tdPosition = document.createElement('td');
          tdPosition.textContent = r.position || '';

          const tdCheckin = document.createElement('td');
          tdCheckin.textContent = r.checkin || '';

          const tdTime = document.createElement('td');
          tdTime.textContent = r.createdAt || r.time || '';

          // **Ph·∫ßn quan tr·ªçng: t·∫°o tdAction v√† n√∫t x√≥a**
          const tdAction = document.createElement('td');
          const btnDelete = document.createElement('button');
          btnDelete.classList.add('delete');
          btnDelete.textContent = 'X√≥a';
          btnDelete.setAttribute('aria-label', `X√≥a ƒë·∫∑t ch·ªó c·ªßa ${r.name}, bi·ªÉn s·ªë ${r.license || ''}`);
          btnDelete.onclick = () => deleteReservation(r.id);
          tdAction.appendChild(btnDelete);
          const btnConfirmPayment = document.createElement('button');
          btnConfirmPayment.style.marginLeft = '10px';
          btnConfirmPayment.textContent = r.paid ? 'ƒê√£ thanh to√°n' : 'X√°c nh·∫≠n thanh to√°n';
          btnConfirmPayment.disabled = !!r.paid; // n·∫øu ƒë√£ thanh to√°n th√¨ disable n√∫t
          btnConfirmPayment.onclick = () => confirmPayment(r.id);
          tdAction.appendChild(btnConfirmPayment);

          // Append c√°c c·ªôt v√†o tr
          tr.appendChild(tdName);
          tr.appendChild(tdPlate);
          tr.appendChild(tdPosition);
          tr.appendChild(tdCheckin);
          tr.appendChild(tdTime);
          tr.appendChild(tdAction); // ph·∫£i c√≥ tdAction ƒë∆∞·ª£c khai b√°o tr∆∞·ªõc ƒë√≥

          tbody.appendChild(tr);
        });



        if (filtered.length === 0) {
          tbody.innerHTML = '<tr><td colspan="6" style="text-align:center;">Kh√¥ng c√≥ ƒë·∫∑t ch·ªó ph√π h·ª£p</td></tr>';
        }
      } catch (error) {
        console.error("L·ªói loadReservations:", error);
        const tbody = document.querySelector("#reservationsTable tbody");
        tbody.innerHTML = '<tr><td colspan="6" style="text-align:center; color:red;">L·ªói t·∫£i d·ªØ li·ªáu ƒë·∫∑t ch·ªó</td></tr>';
      }
    }

    // B·ªï sung c√°c option cho filterProvider
    function fillFilterProvider(providers) {
      const select = document.getElementById('filterProvider');
      // L∆∞u gi√° tr·ªã hi·ªán t·∫°i
      const currentValue = select.value;
      select.innerHTML = '<option value="">T·∫•t c·∫£</option>';
      providers.forEach(p => {
        const option = document.createElement('option');
        option.value = p;
        option.textContent = p;
        select.appendChild(option);
      });
      // Gi·ªØ l·∫°i gi√° tr·ªã ƒë√£ ch·ªçn n·∫øu v·∫´n c√≤n
      if (providers.includes(currentValue)) {
        select.value = currentValue;
      }
    }

    // X√≥a ƒë·∫∑t ch·ªó
    async function deleteReservation(id) {
      try {
        const response = await fetch(`/reservations/${id}`, {
          method: 'DELETE'
        });

        if (!response.ok) {
          throw new Error(`HTTP ${response.status} - X√≥a kh√¥ng th√†nh c√¥ng`);
        }

        const res = await response.json();

        if (res.success) {
          alert('X√≥a th√†nh c√¥ng');
          // Load l·∫°i danh s√°ch ƒë·∫∑t ch·ªó sau khi x√≥a th√†nh c√¥ng
          loadReservations();
        } else {
          alert('X√≥a th·∫•t b·∫°i: ' + res.message);
        }

      } catch (err) {
        console.error('L·ªói x√≥a ƒë·∫∑t ch·ªó:', err);
        alert('L·ªói khi x√≥a ƒë·∫∑t ch·ªó');
      }
    }
    async function confirmPayment(id) {
      if (!confirm("X√°c nh·∫≠n kh√°ch ƒë√£ thanh to√°n?")) return;

      try {
        const response = await fetch('/confirm-payment', {
          method: 'POST',
          headers: {
            'Content-Type': 'application/json'
          },
          body: JSON.stringify({ id })  // g·ª≠i id trong body
        });

        if (!response.ok) throw new Error(`HTTP ${response.status} - X√°c nh·∫≠n thanh to√°n th·∫•t b·∫°i`);

        const res = await response.json();
        if (res.success) {
          alert('X√°c nh·∫≠n thanh to√°n th√†nh c√¥ng');
          loadReservations(); // load l·∫°i danh s√°ch ƒë·∫∑t ch·ªó ƒë·ªÉ c·∫≠p nh·∫≠t tr·∫°ng th√°i
        } else {
          alert('X√°c nh·∫≠n thanh to√°n th·∫•t b·∫°i: ' + res.message);
        }
      } catch (error) {
        console.error('L·ªói x√°c nh·∫≠n thanh to√°n:', error);
        alert('L·ªói khi x√°c nh·∫≠n thanh to√°n');
      }
    }


    // Load logs gas
    async function loadLogs() {
      try {
        const res = await fetch("/logs", { cache: "no-store" });
        if (!res.ok) throw new Error(`HTTP ${res.status} - Kh√¥ng th·ªÉ l·∫•y logs`);
        const data = await res.json();

        const tbody = document.querySelector("#logsTable tbody");
        tbody.innerHTML = '';

        if (!Array.isArray(data) || data.length === 0) {
          tbody.innerHTML = '<tr><td colspan="2" style="text-align:center;">Ch∆∞a c√≥ d·ªØ li·ªáu</td></tr>';
          return;
        }

        data.forEach(log => {
          const tr = document.createElement('tr');
          const tdTime = document.createElement('td');
          tdTime.textContent = log.time || '';
          const tdGas = document.createElement('td');
          tdGas.textContent = log.gas ?? '';
          tr.appendChild(tdTime);
          tr.appendChild(tdGas);
          tbody.appendChild(tr);
        });
      } catch (error) {
        console.error('L·ªói loadLogs:', error);
        const tbody = document.querySelector("#logsTable tbody");
        tbody.innerHTML = '<tr><td colspan="2" style="text-align:center; color:red;">L·ªói t·∫£i d·ªØ li·ªáu logs</td></tr>';
      }
    }

    // Refresh to√†n b·ªô d·ªØ li·ªáu
    async function refreshAll() {
      setLoading(true);
      await Promise.all([
        loadStatus(),
        loadReservations(),
        loadLogs()
      ]);
      setLoading(false);
    }

    // --- Qu√©t QR code check-in ---
    function toggleScanner() {
      const reader = document.getElementById('qr-reader');
      const btnToggle = document.getElementById('toggle-scanner-btn');
      const btnStop = document.getElementById('stop-scanner-btn');
      if (reader.style.display === 'none' || reader.style.display === '') {
        startScanner();
        reader.style.display = 'block';
        btnToggle.style.display = 'none';
        btnStop.style.display = 'inline-block';
        document.getElementById('scannerResult').innerText = '';
      } else {
        stopScanner();
      }
    }

    function startScanner() {
      if (html5QrcodeScanner) return; // ƒê√£ ch·∫°y r·ªìi

      const qrReader = new Html5Qrcode("qr-reader");
      html5QrcodeScanner = qrReader;

      const config = { fps: 10, qrbox: 250 };

      qrReader.start(
        { facingMode: "environment" },
        config,
        qrCodeMessage => {
          document.getElementById('scannerResult').innerText = `M√£ QR ƒë√£ qu√©t: ${qrCodeMessage}`;
          // G·ª≠i check-in l√™n server
          checkinQR(qrCodeMessage);
          stopScanner();
        },
        errorMessage => {
          // c√≥ th·ªÉ log n·∫øu c·∫ßn
          // console.log(`QR error: ${errorMessage}`);
        }
      ).catch(err => {
        console.error('L·ªói kh·ªüi t·∫°o camera qu√©t QR:', err);
        alert('Kh√¥ng th·ªÉ m·ªü camera ƒë·ªÉ qu√©t QR.');
        stopScanner();
      });
    }

    function stopScanner() {
      if (!html5QrcodeScanner) return;
      html5QrcodeScanner.stop().then(() => {
        html5QrcodeScanner.clear();
        html5QrcodeScanner = null;
        document.getElementById('qr-reader').style.display = 'none';
        document.getElementById('toggle-scanner-btn').style.display = 'inline-block';
        document.getElementById('stop-scanner-btn').style.display = 'none';
      }).catch(err => {
        console.error('L·ªói d·ª´ng camera:', err);
      });
    }

    // G·ª≠i check-in t·ª´ QR code l√™n backend
    async function checkinQR(qrCode) {
      try {
        const res = await fetch('/checkin', {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({ qr: qrCode })
        });
        if (!res.ok) throw new Error(`HTTP ${res.status} - Check-in th·∫•t b·∫°i`);
        const data = await res.json();
        alert('Check-in th√†nh c√¥ng!');
        // Reload d·ªØ li·ªáu sau check-in
        refreshAll();
      } catch (error) {
        console.error('L·ªói checkinQR:', error);
        alert('Check-in th·∫•t b·∫°i. Vui l√≤ng th·ª≠ l·∫°i.');
      }
    }

    // L·∫Øng nghe s·ª± ki·ªán filter thay ƒë·ªïi
    document.getElementById('filterProvider').addEventListener('change', () => {
      loadReservations();
    });

    // Load d·ªØ li·ªáu ban ƒë·∫ßu khi m·ªü trang
    window.addEventListener('load', () => {
      refreshAll();
    });
    setInterval(loadStatus, 3000);
    loadStatus();
  </script>
</body>

</html>