<h1 align="center">
ğŸš— Dá»± Ãn Nháº­n Diá»‡n BÃ£i Äá»— Xe ThÃ´ng Minh CÃ³ Há»‡ Thá»‘ng GiÃ¡m SÃ¡t Online
</h1>
<div align="center">
  <img src="README/logoDaiNam.png" alt="DaiNam University Logo" width="250">
</div>
<br>
<div align="center">

[![FIT DNU](https://img.shields.io/badge/-FIT%20DNU-28a745?style=for-the-badge)](https://fitdnu.net/)
[![DAINAM UNIVERSITY](https://img.shields.io/badge/-DAINAM%20UNIVERSITY-dc3545?style=for-the-badge)](https://dainam.edu.vn/vi)

</div>


<hr>

<h2 align="center">âœ¨ MÃ´ táº£ dá»± Ã¡n</h2>
<p align="justify">
  ÄÃ¢y lÃ  dá»± Ã¡n mÃ´ phá»ng <strong>**BÃƒI Äá»– XE THÃ”NG MINH CÃ“ GIÃM SÃT ONLINE**</strong> sá»­ dá»¥ng **Arduino + ESP32**, káº¿t há»£p vá»›i **cáº£m biáº¿n há»“ng ngoáº¡i vÃ  cáº£m biáº¿n khÃ­ gas <strong>ESP32-CAM</strong>. Há»‡ thá»‘ng há»— trá»£ <strong> khÃ¡ch Ä‘áº·t chá»— trÆ°á»›c qua QR code <strong>Ä‘á»“ng thá»i cÃ³ chá»©c nÄƒng **cáº£nh bÃ¡o kháº©n cáº¥p** khi phÃ¡t hiá»‡n khÃ­ gas vÆ°á»£t ngÆ°á»¡ng.</strong>
</p>

<hr>

<h2 align="center">ğŸš€ Cáº¥u trÃºc dá»± Ã¡n</h2>
<pre>
ğŸ“‚ IOT
â”œâ”€â”€ ğŸ“ models/                   # ThÆ° má»¥c chá»©a cÃ¡c file xá»­ lÃ½ dá»¯ liá»‡u (models, slots, ngÆ°á»i dÃ¹ng)
â”œâ”€â”€ ğŸ“ node_modules/             # ThÆ° viá»‡n Ä‘Æ°á»£c cÃ i thÃ´ng qua npm
â”œâ”€â”€ ğŸ“ public/                   # TÃ i nguyÃªn tÄ©nh phá»¥c vá»¥ frontend
â”‚   â”œâ”€â”€ ğŸ¨ admin-style.css       # Giao diá»‡n cho trang quáº£n trá»‹
â”‚   â”œâ”€â”€ ğŸ“„ admin.html            # Giao diá»‡n dÃ nh cho admin
â”‚   â”œâ”€â”€ ğŸ“„ index.html            # Giao diá»‡n dÃ nh cho khÃ¡ch hÃ ng
â”‚   â””â”€â”€ ğŸ¨ style.css             # CSS dÃ¹ng chung cho giao diá»‡n ngÆ°á»i dÃ¹ng
â”œâ”€â”€ ğŸ“ readme/                   # ThÆ° má»¥c chá»©a tÃ i nguyÃªn liÃªn quan README
â”‚   â””â”€â”€ ğŸ–¼ï¸ logoDaiNam.png        # HÃ¬nh áº£nh logo dá»± Ã¡n
â”œâ”€â”€ ğŸ“œ package.json              # ThÃ´ng tin dá»± Ã¡n & cÃ¡c dependencies
â”œâ”€â”€ ğŸ“¦ package-lock.json         # KhÃ³a version cÃ¡c gÃ³i npm
â”œâ”€â”€ ğŸ“„ server.js                 # File chÃ­nh cháº¡y backend Node.js + Express
â”œâ”€â”€ ğŸ”‘ serviceAccountKey.json    # KhÃ³a Firebase Admin (báº£o máº­t â€“ khÃ´ng chia sáº»)
â”œâ”€â”€ ğŸ“˜ README.md                 # TÃ i liá»‡u mÃ´ táº£ dá»± Ã¡n
â””â”€â”€ ğŸ“ readme.md                 # TÃ i liá»‡u mÃ´ táº£ dá»± Ã¡n
</pre>


<hr>

<h2 align="center">ğŸ¬ Video Demo Hoáº¡t Äá»™ng Há»‡ Thá»‘ng</h2>

<div align="center">
  <a href="https://drive.google.com/file/d/1im_NQEWLpBCS8JXcxpUmRe5tx2diqXFN/view?usp=sharing" target="_blank">
    <img src="README/image1.png" alt="Video demo" width="60%">
  </a>
</div>

<hr>

## Chuáº©n bá»‹ 
### ğŸ› ï¸ Pháº§n cá»©ng

<div align="center>

[![Arduino Uno R3](https://img.shields.io/badge/-ARDUINO%20UNO%20R3-00979D?style=for-the-badge&logo=arduino&logoColor=white)](#)
[![ESP32](https://img.shields.io/badge/ESP32-%23239121.svg?style=for-the-badge&logo=esp32&logoColor=white)](#)
[![Servo](https://img.shields.io/badge/-SERVO-DC143C?style=for-the-badge)](#)
[![WiFi](https://img.shields.io/badge/-WIFI-007396?style=for-the-badge)](#)
[![DÃ¢y Káº¿t Ná»‘i](https://img.shields.io/badge/-D%C3%82Y%20K%E1%BA%BET%20N%E1%BB%90I-555555?style=for-the-badge)](#)
[![Cáº£m biáº¿n há»“ng ngoáº¡i (x4)](https://img.shields.io/badge/Cáº£m%20biáº¿n%20há»“ng%20ngoáº¡i-FF5733?style=for-the-badge)](#)
[![Cáº£m Biáº¿n KhÃ­ Gas](https://img.shields.io/badge/Cáº£m%20biáº¿n%20khÃ­%20Gas%20MQ--2-5C3EE8?style=for-the-badge)](#)
[![MÃ n LCD](https://img.shields.io/badge/LCD%2016x2-28B463?style=for-the-badge)](#)
[![CÃ²i ChÃ­p (Buzzer)](https://img.shields.io/badge/Buzzer%20Cáº£nh%20BÃ¡o-F39C12?style=for-the-badge)](#)



<hr>


### ğŸ’» Pháº§n má»m

### ğŸ’» Pháº§n má»m sá»­ dá»¥ng

[![Node.js](https://img.shields.io/badge/-Node.js-339933?style=for-the-badge&logo=nodedotjs&logoColor=white)](#)
[![Express](https://img.shields.io/badge/-Express.js-000000?style=for-the-badge&logo=express&logoColor=white)](#)
[![Firebase Admin SDK](https://img.shields.io/badge/-Firebase%20Admin-FFCA28?style=for-the-badge&logo=firebase&logoColor=black)](#)
[![HTML](https://img.shields.io/badge/-HTML5-E34F26?style=for-the-badge&logo=html5&logoColor=white)](#)
[![CSS3](https://img.shields.io/badge/-CSS3-1572B6?style=for-the-badge&logo=css3&logoColor=white)](#)
[![JavaScript](https://img.shields.io/badge/-JavaScript-F7DF1E?style=for-the-badge&logo=javascript&logoColor=black)](#)
[![Fetch API](https://img.shields.io/badge/-Fetch%20API-FF6F00?style=for-the-badge)](#)
[![VS Code](https://img.shields.io/badge/-Visual%20Studio%20Code-007ACC?style=for-the-badge&logo=visualstudiocode&logoColor=white)](#)
[![JSON](https://img.shields.io/badge/-JSON-000000?style=for-the-badge&logo=json&logoColor=white)](#)

</div>

<hr>

<h2 align="center">ğŸ“¦ CÃ¡c thÆ° viá»‡n Node.js cáº§n thiáº¿t</h2>
<p align="justify">
  <strong>CÃ¡c gÃ³i cáº§n cÃ i Ä‘áº·t:</strong><br>
  - express<br>
  - firebase-admin<br>
  - uuid<br><br>

  <strong>CÃ i cÃ¡c module cáº§n thiáº¿t:</strong><br>
 
  <code>npm install</code><br><br>
  
  <strong>Lá»‡nh cÃ i thÆ° viá»‡n:</strong><br>
  - (TÃ¹y chá»n) Táº¡o mÃ´i trÆ°á»ng áº£o (nÃªn dÃ¹ng <code>nvm</code> hoáº·c <code>npm init</code>):<br>
  <code>npm init -y</code><br><br>

  - CÃ i Ä‘áº·t cÃ¡c gÃ³i:<br>
  <code>npm install express firebase-admin uuid</code><br><br>

  - <strong>Cháº¡y server:</strong><br>
  <code>node server.js</code>
  <p><em>LÆ°u Ã½: Äáº£m báº£o Ä‘Ã£ cáº¥u hÃ¬nh Ä‘Ãºng file <code>serviceAccountKey.json</code> trÆ°á»›c khi cháº¡y server.</em></p>
</p>

<hr>

<h2 align="center">ğŸ§® Báº£ng máº¡ch</h2>
<p align="center">
  â›“ï¸â€ğŸ’¥ <strong>HÆ°á»›ng dáº«n cáº¯m dÃ¢y:</strong>
</p>

<hr>

<h2 align="center">Cáº¯m cÃ¡c thiáº¿t bá»‹</h2>
<div align="center">
  <img src="README/noiday.jpg" alt="Cáº¯m cÃ¡c thiáº¿t bá»‹" width="100%">
</div>

<h4 align="center">ğŸ“¡ Cáº£m biáº¿n Gas</h4>
<div align="center">
<table>
  <tr>
    <th>Thiáº¿t bá»‹</th>
    <th>ChÃ¢n</th>
    <th>GiÃ¡ trá»‹</th>
    <th>Ghi chÃº</th>
  </tr>
  <tr>
    <td>Cáº£m biáº¿n Gas</td>
    <td>VCC</td>
    <td>5V</td>
    <td>Cáº¥p nguá»“n cho cáº£m biáº¿n</td>
  </tr>
  <tr>
    <td></td>
    <td>GND</td>
    <td>GND</td>
    <td>Ná»‘i Ä‘áº¥t</td>
  </tr>
  <tr>
    <td></td>
    <td>A0</td>
    <td>A0</td>
    <td>Äá»c giÃ¡ trá»‹ gas tá»« cáº£m biáº¿n (analog)</td>
  </tr>
</table>
</div>

<br>

<h4 align="center">ğŸš— Cáº£m biáº¿n xe (Cam1 & Cam2)</h4>
<div align="center">
<table>
  <tr>
    <th>Thiáº¿t bá»‹</th>
    <th>ChÃ¢n</th>
    <th>GiÃ¡ trá»‹</th>
    <th>Ghi chÃº</th>
  </tr>
  <tr>
    <td>Cam1 (Cáº£m biáº¿n Ä‘áº§u vÃ o)</td>
    <td>OUT</td>
    <td>D2</td>
    <td>PhÃ¡t hiá»‡n xe vÃ o</td>
  </tr>
  <tr>
    <td>Cam2 (Cáº£m biáº¿n Ä‘áº§u ra)</td>
    <td>OUT</td>
    <td>D3</td>
    <td>PhÃ¡t hiá»‡n xe ra</td>
  </tr>
</table>
</div>

<br>

<h4 align="center">ğŸ“ Cáº£m biáº¿n vá»‹ trÃ­ Ä‘á»— (Park1 & Park2)</h4>
<div align="center">
<table>
  <tr>
    <th>Thiáº¿t bá»‹</th>
    <th>ChÃ¢n</th>
    <th>GiÃ¡ trá»‹</th>
    <th>Ghi chÃº</th>
  </tr>
  <tr>
    <td>Park1</td>
    <td>OUT</td>
    <td>D5</td>
    <td>PhÃ¡t hiá»‡n xe Ä‘á»— Ä‘Ãºng vá»‹ trÃ­ Ä‘áº§u tiÃªn</td>
  </tr>
  <tr>
    <td>Park2</td>
    <td>OUT</td>
    <td>D6</td>
    <td>PhÃ¡t hiá»‡n xe Ä‘á»— Ä‘Ãºng/sai á»Ÿ vá»‹ trÃ­ thá»© hai</td>
  </tr>
</table>
</div>

<br>

<h4 align="center">ğŸ§  Káº¿t ná»‘i Arduino & ESP32 (Giao tiáº¿p Serial)</h4>
<div align="center">
<table>
  <tr>
    <th>Arduino</th>
    <th>ESP32</th>
    <th>Chá»©c nÄƒng</th>
  </tr>
  <tr>
    <td>D10 (TX)</td>
    <td>RX</td>
    <td>Truyá»n dá»¯ liá»‡u tá»« Arduino sang ESP32</td>
  </tr>
  <tr>
    <td>D11 (RX)</td>
    <td>TX</td>
    <td>Nháº­n dá»¯ liá»‡u tá»« ESP32</td>
  </tr>
</table>
<p><i>Sá»­ dá»¥ng thÆ° viá»‡n <code>SoftwareSerial</code> Ä‘á»ƒ giao tiáº¿p giá»¯a Arduino vÃ  ESP32</i></p>
</div>

<br>

<h4 align="center">ğŸ”© Servo (Barie)</h4>
<div align="center">
<table>
  <tr>
    <th>Thiáº¿t bá»‹</th>
    <th>ChÃ¢n</th>
    <th>GiÃ¡ trá»‹</th>
    <th>Ghi chÃº</th>
  </tr>
  <tr>
    <td>Servo</td>
    <td>VCC</td>
    <td>5V</td>
    <td>Cáº¥p nguá»“n cho servo</td>
  </tr>
  <tr>
    <td></td>
    <td>GND</td>
    <td>GND</td>
    <td>Ná»‘i Ä‘áº¥t</td>
  </tr>
  <tr>
    <td></td>
    <td>Signal</td>
    <td>D9</td>
    <td>Äiá»u khiá»ƒn má»Ÿ/Ä‘Ã³ng barie</td>
  </tr>
</table>
</div>

<br>

<h4 align="center">ğŸ’¡ ÄÃ¨n LED tráº¡ng thÃ¡i</h4>
<div align="center">
<table>
  <tr>
    <th>LED</th>
    <th>ChÃ¢n Arduino</th>
    <th>MÃ u</th>
    <th>Ghi chÃº</th>
  </tr>
  <tr>
    <td>LED Äá»</td>
    <td>D7</td>
    <td>Äá»</td>
    <td>Báº­t khi barie Ä‘Ã³ng hoáº·c há»‡ thá»‘ng nguy hiá»ƒm</td>
  </tr>
  <tr>
    <td>LED Xanh</td>
    <td>D12</td>
    <td>Xanh</td>
    <td>Báº­t khi barie má»Ÿ</td>
  </tr>
</table>
</div>

<br>

<h4 align="center">ğŸ“Ÿ MÃ n hÃ¬nh LCD I2C (20x4)</h4>
<div align="center">
<table>
  <tr>
    <th>Thiáº¿t bá»‹</th>
    <th>ChÃ¢n</th>
    <th>Arduino</th>
    <th>Ghi chÃº</th>
  </tr>
  <tr>
    <td>LCD I2C</td>
    <td>VCC</td>
    <td>5V</td>
    <td>Cáº¥p nguá»“n cho mÃ n hÃ¬nh</td>
  </tr>
  <tr>
    <td></td>
    <td>GND</td>
    <td>GND</td>
    <td>Ná»‘i Ä‘áº¥t</td>
  </tr>
  <tr>
    <td></td>
    <td>SDA</td>
    <td>A4</td>
    <td>Dá»¯ liá»‡u I2C</td>
  </tr>
  <tr>
    <td></td>
    <td>SCL</td>
    <td>A5</td>
    <td>Clock I2C</td>
  </tr>
</table>
</div>


<hr>

<h2 align="center">ğŸš€ HÆ°á»›ng dáº«n cÃ i Ä‘áº·t vÃ  cháº¡y</h2>
<p align="justify">

## I. Chuáº©n bá»‹ pháº§n Cá»©ng

- 1. **Náº¡p mÃ£ Arduino:**
  - - Má»Ÿ tá»‡p cÃ³ tÃªn lÃ  Arduino báº±ng Arduino IDE.
  - Káº¿t ná»‘i board Arduino vá»›i mÃ¡y tÃ­nh.
  - Náº¡p (upload) mÃ£ nguá»“n lÃªn board.
  - Äáº£m báº£o Arduino xuáº¥t hiá»‡n trÃªn cá»•ng COM.
- 2. **Náº¡p mÃ£ cho ESP32 vá»›i file `Esp32`.**
  - Má»Ÿ file `ESP32` báº±ng Arduino IDE.
  - Káº¿t ná»‘i board Arduino vá»›i mÃ¡y tÃ­nh.
  - Náº¡p (upload) mÃ£ nguá»“n lÃªn board giá»¯ nÃºt boot trÃªn ESP32.
  - Äáº£m báº£o ESP32 xuáº¥t hiá»‡n trÃªn cá»•ng COM.

## II. CÃ€I Äáº¶T PHáº¦N Má»€M:

### 2.1 CÃ i Ä‘áº·t Arduino IDE:

- Táº£i Arduino IDE táº¡i: [Arduino Software](https://www.arduino.cc/en/software)
- CÃ i Ä‘áº·t Driver CH340 náº¿u dÃ¹ng board Arduino clone.
- CÃ i Ä‘áº·t Driver CP210xVCP cho ESP32.

### 2.2 CÃ i Ä‘áº·t thÆ° viá»‡n cho Arduino:

- Má»Ÿ Arduino IDE â†’ Library Manager (Ctrl + Shift + I), tÃ¬m vÃ  cÃ i:
  - `Servo.h` (Äiá»u khiá»ƒn servo)
  - `SoftwareSerial.h` (Giao tiáº¿p ná»‘i tiáº¿p giáº£ láº­p Ä‘á»ƒ káº¿t ná»‘i Arduino vá»›i ESP32 qua cÃ¡c chÃ¢n digital 10 vÃ  11)
  - `Wire.h` (Giao tiáº¿p I2C dÃ¹ng cho mÃ n hÃ¬nh LCD I2C)
  - `LiquidCrystal_I2C.h` (Äiá»u khiá»ƒn mÃ n hÃ¬nh LCD I2C 20x4)


<hr>

<h2 align="center">Hoáº¡t Ä‘á»™ng cá»§a há»‡ thá»‘ng</h2>
<div align="center">
  <img src="README/sodo.jpg" alt="Kiáº¿n trÃºc há»‡ thá»‘ng" width="100%">
</div>

---

<p align="justify">
 **1ï¸âƒ£ Khá»Ÿi Ä‘á»™ng há»‡ thá»‘ng:**

- Báº­t nguá»“n cho Arduino, ESP32 vÃ  mÃ¡y tÃ­nh.
- Má»Ÿ Serial Monitor (9600 baud) trÃªn Arduino IDE Ä‘á»ƒ theo dÃµi hoáº¡t Ä‘á»™ng.
- Má»Ÿ Serial Monitor (115200 baud) trÃªn ESP32 Ä‘á»ƒ theo dÃµi hoáº¡t Ä‘á»™ng.
- Cháº¡y Web Server trÃªn PC báº±ng lá»‡nh: `node server.js`

---

## III. Quy trÃ¬nh hoáº¡t Ä‘á»™ng:

1. **Khá»Ÿi Ä‘á»™ng há»‡ thá»‘ng**
   - MÃ n hÃ¬nh LCD hiá»ƒn thá»‹ thÃ´ng bÃ¡o "Khá»Ÿi Ä‘á»™ng há»‡ thá»‘ng".
   - Barie á»Ÿ tráº¡ng thÃ¡i Ä‘Ã³ng (servo á»Ÿ gÃ³c 0 Ä‘á»™).
   - CÃ¡c cáº£m biáº¿n vÃ  LED Ä‘Æ°á»£c thiáº¿t láº­p tráº¡ng thÃ¡i ban Ä‘áº§u.

2. **PhÃ¡t hiá»‡n khÃ­ gas nguy hiá»ƒm**
   - Cáº£m biáº¿n khÃ­ gas (chÃ¢n A0) liÃªn tá»¥c Ä‘o giÃ¡ trá»‹ khÃ­ trong khÃ´ng khÃ­.
   - Náº¿u giÃ¡ trá»‹ vÆ°á»£t ngÆ°á»¡ng cao (`gasThresholdHigh`), há»‡ thá»‘ng cáº£nh bÃ¡o nguy hiá»ƒm:
     - Má»Ÿ barie (servo xoay gÃ³c 90 Ä‘á»™).
     - Báº­t cÃ²i bÃ¡o Ä‘á»™ng.
     - Gá»­i tÃ­n hiá»‡u cáº£nh bÃ¡o `GAS_ALERT` Ä‘áº¿n ESP32.
     - LCD hiá»ƒn thá»‹ tráº¡ng thÃ¡i khÃ­ gas "Nguy hiá»ƒm" vÃ  barie "Má»Ÿ (Gas)".
     - Gá»­i thÃ´ng bÃ¡o cáº£nh bÃ¡o vá» Telegram.
   - Khi giÃ¡ trá»‹ khÃ­ gas giáº£m dÆ°á»›i ngÆ°á»¡ng tháº¥p (`gasThresholdLow`), há»‡ thá»‘ng táº¯t cáº£nh bÃ¡o, Ä‘Ã³ng barie, táº¯t cÃ²i, vÃ  LCD hiá»ƒn thá»‹ tráº¡ng thÃ¡i an toÃ n.

3. **PhÃ¡t hiá»‡n xe Ä‘áº¿n (Cáº£m biáº¿n Cam1)**
   - Khi cáº£m biáº¿n Cam1 (chÃ¢n 2) phÃ¡t hiá»‡n xe (tÃ­n hiá»‡u LOW), náº¿u bÃ£i chÆ°a Ä‘áº§y:
     - Gá»­i tÃ­n hiá»‡u `"XE_DEN"` cho ESP32 Ä‘á»ƒ yÃªu cáº§u quÃ©t QR.
     - Barie giá»¯ tráº¡ng thÃ¡i Ä‘Ã³ng, LCD hiá»ƒn thá»‹ "Äá»£i QR".
   - Náº¿u bÃ£i Ä‘Ã£ Ä‘áº§y theo dá»¯ liá»‡u Ä‘áº·t trÆ°á»›c tá»« ESP32, cÃ²i sáº½ bÃ¡o hiá»‡u tá»« chá»‘i xe.
4. **Má»Ÿ barie cho xe há»£p lá»‡**
   - Khi nháº­n Ä‘Æ°á»£c lá»‡nh `open` tá»« ESP32 (sau khi xÃ¡c nháº­n QR há»£p lá»‡), barie sáº½ má»Ÿ.
   - Xe Ä‘i vÃ o qua cáº£m biáº¿n Cam2 (chÃ¢n 3).
   - Khi xe qua Cam2 hoÃ n toÃ n, barie tá»± Ä‘á»™ng Ä‘Ã³ng láº¡i.
   - Sá»‘ xe trong bÃ£i tÄƒng lÃªn 1, tráº¡ng thÃ¡i Ä‘Æ°á»£c gá»­i vá» ESP32 vÃ  hiá»ƒn thá»‹ trÃªn LCD.

5. **Xe ra khá»i bÃ£i**
   - Khi phÃ¡t hiá»‡n xe Ä‘i ra táº¡i cáº£m biáº¿n Cam2 (vÃ  sá»‘ xe > 0), barie sáº½ má»Ÿ.
   - Xe Ä‘i qua cáº£m biáº¿n Cam1 ra khá»i bÃ£i, barie Ä‘Ã³ng láº¡i.
   - Sá»‘ xe trong bÃ£i giáº£m 1, tráº¡ng thÃ¡i gá»­i vá» ESP32 vÃ  cáº­p nháº­t trÃªn LCD.

6. **Kiá»ƒm tra vá»‹ trÃ­ Ä‘á»— xe vÃ  cÃ²i cáº£nh bÃ¡o**
   - Hai cáº£m biáº¿n Ä‘á»— xe (`park1` vÃ  `park2`) theo dÃµi vá»‹ trÃ­ xe Ä‘á»—.
   - Náº¿u xe Ä‘á»— sai vá»‹ trÃ­ (vÃ­ dá»¥ `park2` cÃ³ xe nhÆ°ng sá»‘ xe trong bÃ£i chÆ°a Ä‘á»§ 2), cÃ²i bÃ¡o Ä‘á»™ng sáº½ Ä‘Æ°á»£c kÃ­ch hoáº¡t Ä‘á»ƒ cáº£nh bÃ¡o.

7. **Gá»­i tráº¡ng thÃ¡i Ä‘á»— xe Ä‘á»‹nh ká»³**
   - Má»—i 5 giÃ¢y, há»‡ thá»‘ng gá»­i tráº¡ng thÃ¡i chá»— Ä‘á»— xe (cáº£m biáº¿n `park1`, `park2`) vá» ESP32 Ä‘á»ƒ theo dÃµi vÃ  hiá»ƒn thá»‹.
   - Arduino nháº­n káº¿t quáº£ vÃ  Ä‘iá»u khiá»ƒn Ä‘á»™ng cÆ¡, servo.

</p>

<hr>

<h2 align="center">Giáº£i thÃ­ch code</h2>
<p align="justify">
  # Há»‡ Thá»‘ng Quáº£n LÃ½ BÃ£i Äá»— Xe vá»›i Arduino vÃ  ESP32

## IV. MÃ´ táº£ há»‡ thá»‘ng

### 1. Arduino Code (`arduino.ino`)

- **Khá»Ÿi táº¡o:**
  - Serial tá»‘c Ä‘á»™ 9600.
  - Sá»­ dá»¥ng cÃ¡c thÆ° viá»‡n: `Servo.h`, `SoftwareSerial.h`, `Wire.h`, `LiquidCrystal_I2C.h`.
  - Cáº¥u hÃ¬nh chÃ¢n káº¿t ná»‘i:
    - Cáº£m biáº¿n xe: `cam1` (D2), `cam2` (D3).
    - Cáº£m biáº¿n vá»‹ trÃ­ Ä‘á»—: `park1` (D5), `park2` (D6).
    - Cáº£m biáº¿n khÃ­ gas: Analog A0.
    - CÃ²i cáº£nh bÃ¡o: D8.
    - LED bÃ¡o tráº¡ng thÃ¡i: Äá» (D7), Xanh (D12).
    - Servo Ä‘iá»u khiá»ƒn barie: D9.
  - Giao tiáº¿p vá»›i ESP32 qua UART má»m: `SoftwareSerial(10, 11)`.
  - Hiá»ƒn thá»‹ thÃ´ng tin qua mÃ n hÃ¬nh LCD I2C (`LiquidCrystal_I2C`).

- **VÃ²ng láº·p chÃ­nh:**
  - Äá»c dá»¯ liá»‡u cáº£m biáº¿n:
    - Äá»c giÃ¡ trá»‹ khÃ­ gas tá»« analog A0.
    - Äá»c tráº¡ng thÃ¡i cáº£m biáº¿n cam1, cam2 Ä‘á»ƒ xÃ¡c Ä‘á»‹nh xe Ä‘áº¿n/Ä‘i.
    - Äá»c tráº¡ng thÃ¡i cáº£m biáº¿n Ä‘á»— xe park1, park2.
  
- **Xá»­ lÃ½ dá»¯ liá»‡u & hÃ nh Ä‘á»™ng:**
  - **PhÃ¡t hiá»‡n khÃ­ gas:**
    - Náº¿u ná»“ng Ä‘á»™ khÃ­ gas vÆ°á»£t ngÆ°á»¡ng â†’ má»Ÿ barie, báº­t cÃ²i, gá»­i `"GAS_ALERT"` Ä‘áº¿n ESP32.
    - Náº¿u khÃ­ gas giáº£m â†’ Ä‘Ã³ng barie, táº¯t cÃ²i.
  - **Nháº­n lá»‡nh tá»« ESP32:**
    - `"open"` â†’ má»Ÿ barie, cho xe vÃ o.
    - `"beep"` â†’ báº­t cÃ²i cáº£nh bÃ¡o Ä‘á»— sai.
    - `"stopbeep"` â†’ táº¯t cÃ²i.
  - **Xá»­ lÃ½ xe vÃ o (qua cam2):**
    - Khi xe Ä‘i qua cam2 sau khi barie má»Ÿ â†’ Ä‘Ã³ng barie, tÄƒng biáº¿n Ä‘áº¿m `soXe`, gá»­i `"SOXE:x"` vá» ESP32.
  - **Xá»­ lÃ½ xe ra (qua cam2 â†’ cam1):**
    - Khi cÃ³ xe Ä‘i ra (cam2 LOW rá»“i qua cam1) â†’ má»Ÿ barie, giáº£m `soXe`, gá»­i `"SOXE:x"` vá» ESP32, Ä‘Ã³ng barie sau khi xe Ä‘i qua.
  - **Kiá»ƒm tra Ä‘á»— sai:**
    - Náº¿u cÃ³ xe á»Ÿ `park2` nhÆ°ng `soXe < 2` â†’ bÃ¡o Ä‘á»— sai, báº­t cÃ²i cáº£nh bÃ¡o.
    - Náº¿u xe Ä‘á»— Ä‘Ãºng hoáº·c Ä‘i khá»i â†’ táº¯t cÃ²i.
  - **Gá»­i tráº¡ng thÃ¡i Ä‘á»‹nh ká»³:**
    - Gá»­i tráº¡ng thÃ¡i chá»— Ä‘á»— xe Ä‘á»‹nh ká»³ (vÃ­ dá»¥ `"PARKING:x,y"`) má»—i 5 giÃ¢y vá» ESP32.

---

### 2. ESP32 Code (`esp32.ino`)

- **Khá»Ÿi táº¡o:**
  - Serial tá»‘c Ä‘á»™ 115200.
  - Káº¿t ná»‘i WiFi (SSID).
  - Cáº¥u hÃ¬nh UART giao tiáº¿p vá»›i Arduino (`RX: D16`, `TX: D17`).
  - Thiáº¿t láº­p server vá»›i cÃ¡c endpoint:
    - `POST /fromarduino`: nháº­n dá»¯ liá»‡u tá»« Arduino.
    - `GET /command`: láº¥y lá»‡nh tá»« server.
    - `POST /commands/reset`: reset lá»‡nh.

- **VÃ²ng láº·p chÃ­nh:**
  - Nháº­n dá»¯ liá»‡u tá»« Arduino:
    - `"GAS_ALERT"` â†’ gá»­i bÃ¡o Ä‘á»™ng gas lÃªn server.
    - `"SOXE:x"` hoáº·c `"Tong xe: x"` â†’ cáº­p nháº­t sá»‘ xe.
    - `"PARKING:x,y"` â†’ cáº­p nháº­t tráº¡ng thÃ¡i cÃ¡c slot.

- **Gá»­i dá»¯ liá»‡u lÃªn server:**
  - Khi cáº­p nháº­t tráº¡ng thÃ¡i bÃ¬nh thÆ°á»ng:
    ```json
    {
      "event": "update",
      "total": x,
      "slots": [2, 0]
    }
    ```
  - Khi phÃ¡t hiá»‡n bÃ¡o Ä‘á»™ng khÃ­ gas:
    ```json
    {
      "event": "gas_alert",
      "total": x,
      "slots": [2, 0],
      "gas": 300
    }
    ```

---

## 3. ChÃº Ã½

- Tham sá»‘ `x` Ä‘áº¡i diá»‡n cho sá»‘ lÆ°á»£ng xe hiá»‡n táº¡i.
- CÃ¡c giÃ¡ trá»‹ trong `slots` Ä‘áº¡i diá»‡n tráº¡ng thÃ¡i chá»— Ä‘á»— (vÃ­ dá»¥: sá»‘ xe Ä‘á»— táº¡i cÃ¡c vá»‹ trÃ­).
- GiÃ¡ trá»‹ `"gas": 300` chá»‰ mang tÃ­nh minh há»a, thá»±c táº¿ láº¥y tá»« cáº£m biáº¿n gas.

  ---

### 4. Xá»­ lÃ½ Ä‘iá»u kiá»‡n cÃ²i cáº£nh bÃ¡o

- Náº¿u `slot2 = 2` vÃ  `slot1 â‰  2` â†’ Ä‘Æ°á»£c xem lÃ  Ä‘á»— sai chá»—.
- Khi phÃ¡t hiá»‡n Ä‘á»— sai, gá»­i lá»‡nh `"beep"` cho Arduino **má»™t láº§n duy nháº¥t** Ä‘á»ƒ báº­t cÃ²i cáº£nh bÃ¡o.
- Náº¿u Ä‘iá»u kiá»‡n Ä‘á»— sai khÃ´ng cÃ²n tá»“n táº¡i, táº¯t cháº¿ Ä‘á»™ cáº£nh bÃ¡o vÃ  Ä‘áº·t biáº¿n `beepSent = false` Ä‘á»ƒ sáºµn sÃ ng phÃ¡t hiá»‡n láº§n sau.

### 5. Kiá»ƒm tra lá»‡nh tá»« server

- ESP32 gá»­i yÃªu cáº§u `GET /command` Ä‘áº¿n server má»—i 3 giÃ¢y Ä‘á»ƒ láº¥y lá»‡nh Ä‘iá»u khiá»ƒn.
- Náº¿u server tráº£ vá» lá»‡nh `"open"` â†’ ESP32 gá»­i lá»‡nh `"open"` vá» Arduino Ä‘á»ƒ má»Ÿ barie cho xe vÃ o.
- Sau khi xá»­ lÃ½ lá»‡nh, ESP32 gá»­i `POST` rá»—ng Ä‘áº¿n `POST /commands/reset` Ä‘á»ƒ reset tráº¡ng thÃ¡i lá»‡nh trÃªn server.

---

## V. Node.js & Firebase Code (`server.js`)

### 1. Khá»Ÿi táº¡o

- Server Express cháº¡y táº¡i Ä‘á»‹a chá»‰: `http://localhost:3000/`.
- Káº¿t ná»‘i Firebase Realtime Database sá»­ dá»¥ng Admin SDK thÃ´ng qua file cáº¥u hÃ¬nh `serviceAccountKey.json`.
- Khá»Ÿi táº¡o dá»¯ liá»‡u máº·c Ä‘á»‹nh cho tráº¡ng thÃ¡i bÃ£i Ä‘á»— vÃ  log khÃ­ gas náº¿u chÆ°a tá»“n táº¡i trong cÆ¡ sá»Ÿ dá»¯ liá»‡u.

### 2. Xá»­ lÃ½ dá»¯ liá»‡u tá»« ESP32/Arduino

- Nháº­n dá»¯ liá»‡u tá»« ESP32/Arduino gá»­i lÃªn má»—i 5 giÃ¢y qua route `POST /fromarduino`.
- Dá»¯ liá»‡u nháº­n gá»“m:
  - `event`: loáº¡i sá»± kiá»‡n (vÃ­ dá»¥: `"update"`, `"gas_alert"`).
  - `total`: tá»•ng sá»‘ xe hiá»‡n cÃ³.
  - `slots`: tráº¡ng thÃ¡i cÃ¡c vá»‹ trÃ­ Ä‘á»—.
  - `gas`: ná»“ng Ä‘á»™ khÃ­ gas (náº¿u cÃ³).
- Cáº­p nháº­t sá»‘ xe ra/vÃ o, tráº¡ng thÃ¡i tá»«ng chá»— Ä‘á»— trong Firebase.
- Ghi láº¡i log khÃ­ gas, giá»›i háº¡n tá»‘i Ä‘a 20 báº£n ghi gáº§n nháº¥t.
- Náº¿u phÃ¡t hiá»‡n ná»“ng Ä‘á»™ khÃ­ gas vÆ°á»£t ngÆ°á»¡ng 150 ppm, kÃ­ch hoáº¡t cáº£nh bÃ¡o Telegram.
- Khi khÃ­ gas trá»Ÿ láº¡i má»©c an toÃ n, gá»­i thÃ´ng bÃ¡o khÃ´i phá»¥c qua Telegram.

### 3. Giao tiáº¿p vá»›i Arduino qua API

- `GET /command`: Arduino/ESP32 gá»i Ä‘á»‹nh ká»³ Ä‘á»ƒ láº¥y lá»‡nh Ä‘iá»u khiá»ƒn.
  - Server tráº£ vá» lá»‡nh `"open"`, `"beep"` hoáº·c rá»—ng.
- `POST /commands/reset`: Reset lá»‡nh sau khi Arduino/ESP32 Ä‘Ã£ xá»­ lÃ½ xong.

### 4. Chá»©c nÄƒng Äáº·t chá»— vÃ  Thanh toÃ¡n

- `POST /pre-reserve`: Äáº·t chá»— trÆ°á»›c vá»›i thÃ´ng tin tÃªn, biá»ƒn sá»‘ xe, vá»‹ trÃ­ slot.
- `POST /confirm-payment`: XÃ¡c nháº­n thanh toÃ¡n cho Ä‘áº·t chá»—.
- `GET /check-payment`: Kiá»ƒm tra tráº¡ng thÃ¡i thanh toÃ¡n vÃ  tráº£ vá» mÃ£ QR tÆ°Æ¡ng á»©ng.

### 5. Check-in báº±ng QR Code

- `POST /checkin`: Nháº­n mÃ£ QR tá»« ngÆ°á»i dÃ¹ng.
- Kiá»ƒm tra tÃ­nh há»£p lá»‡ cá»§a mÃ£ QR, Ä‘Ã¡nh dáº¥u checkin vÃ  cáº­p nháº­t tráº¡ng thÃ¡i slot chiáº¿m dá»¥ng.
- Náº¿u xe Ä‘áº§u tiÃªn Ä‘á»— vÃ o slot sá»‘ 2, gá»­i lá»‡nh `"beep"` Ä‘áº¿n Arduino Ä‘á»ƒ cáº£nh bÃ¡o Ä‘á»— sai.

### 6. Quáº£n lÃ½ tráº¡ng thÃ¡i bÃ£i Ä‘á»—

- `GET /status`: Tráº£ vá» toÃ n bá»™ tráº¡ng thÃ¡i bÃ£i Ä‘á»— gá»“m tá»•ng chá»—, sá»‘ chá»— cÃ²n trá»‘ng, sá»‘ xe vÃ o, cáº£nh bÃ¡o khÃ­ gas, v.v.
- `POST /reset-xevao`: Äáº·t láº¡i sá»‘ lÆ°á»£ng xe hiá»‡n táº¡i vá» 0 hoáº·c giÃ¡ trá»‹ máº·c Ä‘á»‹nh.

### 7. Quáº£n lÃ½ Äáº·t chá»—

- `GET /reservations` vÃ  `GET /bookings`: Láº¥y danh sÃ¡ch cÃ¡c Ä‘áº·t chá»— vÃ  Ä‘áº·t trÆ°á»›c.
- `DELETE /reservations/:id`: XÃ³a Ä‘áº·t chá»— theo ID.

### 8. Cáº£nh bÃ¡o khÃ­ gas

- Tá»± Ä‘á»™ng gá»­i cáº£nh bÃ¡o qua Telegram khi ná»“ng Ä‘á»™ khÃ­ gas vÆ°á»£t ngÆ°á»¡ng an toÃ n (>150 ppm).
- `POST /dismiss-gas-alert`: Cho phÃ©p ngÆ°á»i dÃ¹ng táº¯t cáº£nh bÃ¡o khÃ­ gas thá»§ cÃ´ng.

### 9. Xem lá»‹ch sá»­ khÃ­ gas

- `GET /logs`: Tráº£ vá» 20 báº£n ghi khÃ­ gas gáº§n nháº¥t Ä‘á»ƒ hiá»ƒn thá»‹ trÃªn trang web hoáº·c giao diá»‡n admin.

### 10. Giao diá»‡n web

- **KhÃ¡ch hÃ ng:**
  - Cho phÃ©p Ä‘áº·t chá»— vÃ  thanh toÃ¡n, nháº­n mÃ£ QR khi Ä‘Æ°á»£c admin xÃ¡c nháº­n.
- **Admin:**
  - Truy cáº­p `/admin` Ä‘á»ƒ quáº£n lÃ½ toÃ n bá»™ bÃ£i Ä‘á»—: giÃ¡m sÃ¡t tráº¡ng thÃ¡i bÃ£i Ä‘á»—, Ä‘áº·t chá»—, cáº£nh bÃ¡o, vÃ  quÃ©t mÃ£ QR.

### 11. ThÃ´ng bÃ¡o Telegram (Real-time)

- Gá»­i tin nháº¯n cáº£nh bÃ¡o khi phÃ¡t hiá»‡n khÃ­ gas vÆ°á»£t ngÆ°á»¡ng (>150 ppm).
- Gá»­i tin nháº¯n khi khÃ­ gas trá»Ÿ láº¡i má»©c an toÃ n.


<hr>

<h2 align="center">ğŸ“¸ Káº¿t quáº£ hiá»ƒn thá»‹</h2>
<div align="center">
  <p><strong>Tá»•ng quan MÃ´ hÃ¬nh</strong></p>
  <img src="README/image1.png" alt="áº¢nh mÃ´ hÃ¬nh" width="100%">
  
  <p><strong>Äáº·t chá»—</strong></p>
  <img src="README/image3.png" alt="Äáº·t chá»— thÃ nh cÃ´ng in QR" width="100%">
</div>

  <p><strong>Xe VÃ o</strong></p>
  <img src="README/image2.png" alt="Khi cÃ³ xe vÃ o" width="100%">
</div>

<p><strong>QuÃ©t QR thÃ nh cÃ´ng Server tráº£ vá» Open cho Esp32</strong></p>
  <img src="README/image4.png" alt="QuÃ©t QR thÃ nh cÃ´ng Admin" width="100%">
</div>

<p><strong>Xe Ä‘á»— vá»‹ trÃ­ 1 nháº­n diá»‡n gá»­i lÃªn Server Ä‘á»•i mÃ u Ã´ Ä‘á»—</strong></p>
  <img src="README/image5.png" alt="Xe Ä‘á»— vá»‹ trÃ­ 1" width="100%">
</div>

<p><strong>Cáº£nh bÃ¡o khÃ­ GAS</strong></p>
  <img src="README/image6.png" alt="QuÃ©t QR thÃ nh cÃ´ng Admin" width="100%">
</div>

<br>
<hr>


<br>
<hr>

<h2 align="center">ğŸ¤</h2>
<p>Dá»± Ã¡n Ä‘Æ°á»£c phÃ¡t triá»ƒn bá»Ÿi:</p>
<center>
<table>
  <thead>
    <tr>
      <th>Giáº£ng viÃªn hÆ°á»›ng dáº«n</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>Tháº§y Nguyá»…n VÄƒn NhÃ¢n</td>
    </tr>
  </tbody>
</table>
</center>

<center>
<table>
  <thead>
    <tr>
      <th>Há» vÃ  TÃªn</th>
      <th>MÃ£ sinh viÃªn</th>
      <th>Vai trÃ²</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>NgÃ´ Tuáº¥n Minh</td>
      <td>1571020175</td>
      <td>PhÃ¡t triá»ƒn dá»± Ã¡n</td>
    </tr>
  </tbody>
</table>
</center>






<p align="center">Â© 2025 NGÃ” TUáº¤N MINH, CNTT16-06, TRÆ¯á»œNG Äáº I Há»ŒC Äáº I NAM</p>

